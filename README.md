# Click Counter Service

–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å —Å—á–µ—Ç—á–∏–∫–∞ –∫–ª–∏–∫–æ–≤, —Å–ø–æ—Å–æ–±–Ω—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å **1000-5000 RPS**.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker 20.10+
- Docker Compose 2.0+

####Load test
docker/loadtest/results.md

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

| Target RPS | Actual RPS | Success Rate | Avg Latency | P95 Latency | Workers | Total Requests | Failed | Status |
|------------|------------|--------------|-------------|-------------|---------|----------------|--------|---------|
| **100**    | **99.0**   | **100.0%** ‚úÖ | 956¬µs       | 1.441ms     | 10      | 1,990          | 0      | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| **200**    | **198.0**  | **100.0%** ‚úÖ | 1.063ms     | 1.361ms     | 20      | 3,976          | 0      | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| **300**    | **296.9**  | **100.0%** ‚úÖ | 1.418ms     | 1.663ms     | 30      | 5,968          | 0      | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| **400**    | **395.9**  | **100.0%** ‚úÖ | 1.925ms     | 2.282ms     | 40      | 7,958          | 0      | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| **500**    | **494.7**  | **97.3%** ‚ö†Ô∏è  | 2.380ms     | 3.234ms     | 50      | 9,947          | 268    | ‚ö†Ô∏è –î–µ–≥—Ä–∞–¥–∞—Ü–∏—è |
| **600**    | **593.9**  | **79.3%** ‚ùå  | 2.432ms     | 4.455ms     | 60      | 11,936         | 2,476  | ‚ùå –ö—Ä–∏—Ç–∏—á–Ω–æ |


### –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

```bash
cd docker
docker-compose up -d
```

–°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8080

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã

```bash
cd docker
docker-compose down
```

## üìã API Endpoints

| Endpoint | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-------|----------|
| `/health` | GET | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞ |
| `/counter/{id}` | GET | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–∫–∞ –ø–æ –±–∞–Ω–Ω–µ—Ä—É |
| `/stats/{id}` | POST | –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–ª–∏–∫–æ–≤ |

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ —Å–µ—Ä–≤–∏—Å–∞
curl http://localhost:8080/health


# 2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–∫ –ø–æ –±–∞–Ω–Ω–µ—Ä—É 1
curl http://localhost:8080/counter/1

# 3. –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –ø–µ—Ä–∏–æ–¥
curl -X POST http://localhost:8080/stats/1 \
  -H "Content-Type: application/json" \
  -d '{
    "from": "2024-01-01T00:00:00Z",
    "to": "2025-01-01T00:00:00Z"
  }'
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
clickcounter/
‚îú‚îÄ‚îÄ app/                    # –û—Å–Ω–æ–≤–Ω–æ–µ Go –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ cmd/               # –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ internal/          # –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ configs/           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ migrations/        # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ docs/              # Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ docker/                # Docker –æ–∫—Ä—É–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile         # –û–±—Ä–∞–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ README.md             # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   ClickCounter  ‚îÇ    ‚îÇ   PostgreSQL    ‚îÇ
‚îÇ   Application   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ    Database     ‚îÇ
‚îÇ   Port: 8080    ‚îÇ    ‚îÇ   Port: 5432    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **PostgreSQL 15**: –û—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏
- **ClickCounter App**: Go –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å memory –∫—ç—à–µ–º –∏ batch –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
- **Migrate**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## ‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
cd docker

# –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
docker-compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã
docker-compose down

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
docker-compose restart

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose up -d --build

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose logs -f

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose logs -f clickcounter
docker-compose logs -f postgres
```

### –†–µ–∂–∏–º—ã –∑–∞–ø—É—Å–∫–∞

#### 1. Production (–ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)
```bash
cd docker
docker-compose up -d
# –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ http://localhost:8080
```

#### 2. Development (—Ç–æ–ª—å–∫–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
```bash
cd docker
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ PostgreSQL
docker-compose up -d postgres

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ
cd ../app
CLICKCOUNTER_DATABASE_HOST=localhost go run ./cmd/server
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
cd docker

# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose logs -f

# –¢–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker-compose logs -f clickcounter

# –¢–æ–ª—å–∫–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
docker-compose logs -f postgres

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤
docker-compose logs --tail=100 clickcounter
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏
```bash
cd docker

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
docker-compose exec postgres psql -U clickcounter -d clickcounter

# –°–æ–∑–¥–∞—Ç—å backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose exec postgres pg_dump -U clickcounter clickcounter > backup.sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup
docker-compose exec -T postgres psql -U clickcounter -d clickcounter < backup.sql

# –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (—É–¥–∞–ª–∏—Ç—å volumes)
docker-compose down -v
```

### –û—Ç–ª–∞–¥–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```bash
cd docker

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose exec clickcounter sh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose exec clickcounter cat /app/configs/config.docker.yaml

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker-compose exec clickcounter env | grep CLICKCOUNTER

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç–µ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
docker-compose exec clickcounter ping postgres
```


## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
cd docker
docker-compose up -d postgres

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
cd ../app
CLICKCOUNTER_DATABASE_HOST=localhost go run ./cmd/server
```

### –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
cd docker

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker-compose up -d --build clickcounter

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏)
docker-compose restart clickcounter
```

### –†–∞–±–æ—Ç–∞ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

```bash
cd docker

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é
docker-compose run --rm migrate \
  -path /migrations \
  -database "postgres://clickcounter:clickcounter_password@postgres:5432/clickcounter?sslmode=disable" \
  up

# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
docker-compose run --rm migrate \
  -path /migrations \
  -database "postgres://clickcounter:clickcounter_password@postgres:5432/clickcounter?sslmode=disable" \
  down 1
```


### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `docker-compose.yml`:

```yaml
environment:
  # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
  CLICKCOUNTER_DATABASE_HOST: postgres
  CLICKCOUNTER_DATABASE_MAX_OPEN_CONNS: 200
  
  # –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
  CLICKCOUNTER_CLICK_FLUSHER_BATCH_SIZE: 2000
  CLICKCOUNTER_CLICK_FLUSHER_INTERVAL: 2
  
  # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
  CLICKCOUNTER_LOGGER_LEVEL: info
```


## üèÜ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- **DDD (Domain Driven Design)**: –î–æ–º–µ–Ω–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **Go 1.23**: –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- **PostgreSQL 15**: –†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö


